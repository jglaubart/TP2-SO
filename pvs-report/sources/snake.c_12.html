<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>snake.c</title>
  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>
<pre><code class = "cpp">
<a name="ln1">// This is an open source non-commercial project. Dear PVS-Studio, please check it.</a>
<a name="ln2">// PVS-Studio Static Code Analyzer for C, C++ and C#: http://www.viva64.com</a>
<a name="ln3">#include &lt;sys.h&gt;</a>
<a name="ln4">#include &lt;stdio.h&gt;</a>
<a name="ln5">#include &lt;stdlib.h&gt;</a>
<a name="ln6">#include &lt;ctype.h&gt;</a>
<a name="ln7"> </a>
<a name="ln8"> </a>
<a name="ln9">// &lt;----------------------------------------------------------------------- DEFINES -----------------------------------------------------------------------&gt;</a>
<a name="ln10"> </a>
<a name="ln11">#define VALID_DIFFICULTY(c) (c == 'E' || c == 'e' || c == 'M' || c == 'm'|| c == 'H' || c == 'h' || c == 'D' || c == 'd')</a>
<a name="ln12"> </a>
<a name="ln13">#define DIRECTIONS 4</a>
<a name="ln14">#define BEGIN_GAME_KEY '\n'</a>
<a name="ln15">#define PLAY_AGAIN_KEY '\n'</a>
<a name="ln16">#define QUIT_KEY 'X'</a>
<a name="ln17"> </a>
<a name="ln18">// end_of_game values</a>
<a name="ln19">#define ENDED_BY_CRASH 1</a>
<a name="ln20">#define ENDED_BY_QUIT 2</a>
<a name="ln21">#define ENDED_BY_MAX_SIZE 3</a>
<a name="ln22"> </a>
<a name="ln23">#define INITIAL_BODY_SIZE 3</a>
<a name="ln24">#define MAX_BODY_SIZE 100 + INITIAL_BODY_SIZE + 1   // so that the snake eats 100 foods</a>
<a name="ln25">#define SQUARE_DIM 32</a>
<a name="ln26">#define MAX_SNAKES 2</a>
<a name="ln27">#define HEAD 0</a>
<a name="ln28"> </a>
<a name="ln29">// sleeping times</a>
<a name="ln30">#define DEFAULT_GAME_SLEEPING_TIME 500</a>
<a name="ln31">#define DEFAULT_WELCOME_SLEEPING_TIME 700</a>
<a name="ln32">#define DEFAULT_INSTRUCTIONS_SLEEPING_TIME 1000</a>
<a name="ln33">#define DEFAULT_GOODBYE_SLEEPING_TIME 1000</a>
<a name="ln34">#define DEMON 65</a>
<a name="ln35">#define HARD 120</a>
<a name="ln36">#define MEDIUM 170</a>
<a name="ln37">#define EASY 220</a>
<a name="ln38"> </a>
<a name="ln39">// sounds</a>
<a name="ln40">#define EATING_SOUND_FREQUENCY 1400</a>
<a name="ln41">#define CRASHING_SOUND_FREQUENCY 300</a>
<a name="ln42">#define CRASHING_SOUND_DURATION 550</a>
<a name="ln43"> </a>
<a name="ln44">// hues</a>
<a name="ln45">#define HUE_1 120</a>
<a name="ln46">#define HUE_2 0</a>
<a name="ln47"> </a>
<a name="ln48">// initial positions</a>
<a name="ln49">#define INITIAL_POS_1_X (SQUARE_DIM * 28)</a>
<a name="ln50">#define INITIAL_POS_1_Y (SQUARE_DIM * 21)</a>
<a name="ln51">#define INITIAL_POS_2_X (SQUARE_DIM * 3)</a>
<a name="ln52">#define INITIAL_POS_2_Y (SQUARE_DIM * 4)</a>
<a name="ln53"> </a>
<a name="ln54">// initial directions</a>
<a name="ln55">#define INITIAL_DIR_1_X -1</a>
<a name="ln56">#define INITIAL_DIR_1_Y 0</a>
<a name="ln57">#define INITIAL_DIR_2_X 1</a>
<a name="ln58">#define INITIAL_DIR_2_Y 0</a>
<a name="ln59"> </a>
<a name="ln60">// drawing</a>
<a name="ln61">#define DEFAULT_BACKGROUND_COLOR 0x2F2F2F</a>
<a name="ln62">#define DEFAULT_FOOD_COLOR 0xA933DC</a>
<a name="ln63">#define ANSI_1 &quot;\e[0;96m&quot;</a>
<a name="ln64">#define ANSI_2 &quot;\e[0;31m&quot;</a>
<a name="ln65">#define OFFSET 4</a>
<a name="ln66"> </a>
<a name="ln67"> </a>
<a name="ln68">// &lt;----------------------------------------------------------------------- DATA TYPES -----------------------------------------------------------------------&gt;</a>
<a name="ln69"> </a>
<a name="ln70">typedef struct {</a>
<a name="ln71">    int width;</a>
<a name="ln72">    int height;</a>
<a name="ln73">} Square;</a>
<a name="ln74"> </a>
<a name="ln75">typedef struct {</a>
<a name="ln76">    int x;</a>
<a name="ln77">    int y;</a>
<a name="ln78">} Position;</a>
<a name="ln79"> </a>
<a name="ln80">typedef struct {</a>
<a name="ln81">    int x;</a>
<a name="ln82">    int y;</a>
<a name="ln83">} Direction;</a>
<a name="ln84"> </a>
<a name="ln85">typedef struct {</a>
<a name="ln86">    Position position;</a>
<a name="ln87">} SnakeBodySquare;</a>
<a name="ln88"> </a>
<a name="ln89">typedef struct {</a>
<a name="ln90">    int initial_hue;</a>
<a name="ln91">    char * main_ansi;</a>
<a name="ln92">    Direction direction;</a>
<a name="ln93">    int size;</a>
<a name="ln94">    SnakeBodySquare body[MAX_BODY_SIZE];</a>
<a name="ln95">    int lost;</a>
<a name="ln96">} SnakeHeadSquare;</a>
<a name="ln97"> </a>
<a name="ln98">typedef struct {</a>
<a name="ln99">    int hue;</a>
<a name="ln100">    Position position;</a>
<a name="ln101">} Food;</a>
<a name="ln102"> </a>
<a name="ln103"> </a>
<a name="ln104">// &lt;----------------------------------------------------------------------- FUNCTION PROTOTYPES -----------------------------------------------------------------------&gt;</a>
<a name="ln105"> </a>
<a name="ln106">static void setSquareDimensions(void);</a>
<a name="ln107">static void setDefaultFeatures(void);</a>
<a name="ln108"> </a>
<a name="ln109">static void welcomePlayers(void);</a>
<a name="ln110">static void checkMaxBodySize(void);</a>
<a name="ln111">static void endGameByMaxSize(void);</a>
<a name="ln112">static void endGameByQuit(void);</a>
<a name="ln113">static void endGameByCrash(void);</a>
<a name="ln114">static void endGame(int code);</a>
<a name="ln115">static void setDifficulty(char difficulty);</a>
<a name="ln116">static void showWinners(void);</a>
<a name="ln117"> </a>
<a name="ln118">static void registerKeys(void);</a>
<a name="ln119">static void movingTo(int snake, int dir_x, int dir_y);</a>
<a name="ln120">static void setDirection(enum REGISTERABLE_KEYS scancode);</a>
<a name="ln121">static void moveSnakes(void);</a>
<a name="ln122">static void checkCrash(void);</a>
<a name="ln123">static int outOfBounds(int x, int y);</a>
<a name="ln124"> </a>
<a name="ln125">static void drawBackground(void);</a>
<a name="ln126">static void drawSnakes(void);</a>
<a name="ln127">static void drawFood(void);</a>
<a name="ln128">static void printScore(void);</a>
<a name="ln129"> </a>
<a name="ln130">static void setRandomSeed(void);</a>
<a name="ln131">static int overSnakeBody(int x, int y);</a>
<a name="ln132">static void randomizeFoodPosition(void);</a>
<a name="ln133">static void checkFoodEaten(void);</a>
<a name="ln134"> </a>
<a name="ln135">static uint32_t hsv2rgb(uint8_t h, uint8_t s, uint8_t v);</a>
<a name="ln136"> </a>
<a name="ln137"> </a>
<a name="ln138">// &lt;----------------------------------------------------------------------- STATIC VARS -----------------------------------------------------------------------&gt;</a>
<a name="ln139"> </a>
<a name="ln140">// key-movement for each snake</a>
<a name="ln141">static char * movement_directions[] = {&quot;left&quot;, &quot;right&quot;, &quot;up\t&quot;, &quot;down&quot;};</a>
<a name="ln142">static char * movement_keys[][DIRECTIONS] = { {&quot;left arrow&quot;, &quot;right arrow&quot;, &quot;up arrow&quot;, &quot;down arrow&quot;}, {&quot;A&quot;, &quot;D&quot;, &quot;W&quot;, &quot;S&quot;} };</a>
<a name="ln143"> </a>
<a name="ln144">static SnakeHeadSquare snakes[MAX_SNAKES] = {};</a>
<a name="ln145">static Square square;</a>
<a name="ln146">static Food food;</a>
<a name="ln147"> </a>
<a name="ln148">// hues</a>
<a name="ln149">static int hues[] = {HUE_1, HUE_2};</a>
<a name="ln150"> </a>
<a name="ln151">// main colors</a>
<a name="ln152">static char * main_colors[] = {ANSI_1, ANSI_2};</a>
<a name="ln153"> </a>
<a name="ln154">// initial positions</a>
<a name="ln155">static Position initial_positions[MAX_SNAKES] = { { .x = INITIAL_POS_1_X, .y = INITIAL_POS_1_Y } , { .x = INITIAL_POS_2_X, .y = INITIAL_POS_2_Y } };</a>
<a name="ln156"> </a>
<a name="ln157">// initial directions</a>
<a name="ln158">static Direction initial_directions[MAX_SNAKES] = { { .x = INITIAL_DIR_1_X, .y = INITIAL_DIR_1_Y } , { .x = INITIAL_DIR_2_X, .y = INITIAL_DIR_2_Y } };</a>
<a name="ln159"> </a>
<a name="ln160">// screen dimensions</a>
<a name="ln161">static int window_height, window_width;</a>
<a name="ln162">static int border_y = SQUARE_DIM * 2;</a>
<a name="ln163"> </a>
<a name="ln164">static int end_of_game;   // 1 if the game finished because somebody crashed, 2 if it was because X was pressed</a>
<a name="ln165">static int snakes_amount;</a>
<a name="ln166">static int difficulty_level;</a>
<a name="ln167">static int food_eaten;</a>
<a name="ln168">static int first_round;</a>
<a name="ln169"> </a>
<a name="ln170"> </a>
<a name="ln171">// ================================================================================ GAME ================================================================================</a>
<a name="ln172"> </a>
<a name="ln173">int main(void) {</a>
<a name="ln174">    end_of_game = 0;</a>
<a name="ln175">    window_height = getWindowHeight();</a>
<a name="ln176">    window_width = getWindowWidth();</a>
<a name="ln177">    food_eaten = 0;</a>
<a name="ln178"> </a>
<a name="ln179">    welcomePlayers();</a>
<a name="ln180"> </a>
<a name="ln181">    setRandomSeed();</a>
<a name="ln182">    registerKeys();</a>
<a name="ln183">    setSquareDimensions();</a>
<a name="ln184"> </a>
<a name="ln185">    do{</a>
<a name="ln186">        clearScreen();</a>
<a name="ln187">        printf(&quot;\n\n&quot;);</a>
<a name="ln188">        setDefaultFeatures();</a>
<a name="ln189"> </a>
<a name="ln190">        first_round = 1;</a>
<a name="ln191">        drawBackground();</a>
<a name="ln192">        printScore();</a>
<a name="ln193"> </a>
<a name="ln194">        while(!end_of_game) {</a>
<a name="ln195">            drawSnakes();</a>
<a name="ln196">            drawFood();</a>
<a name="ln197">        </a>
<a name="ln198">            sleep(difficulty_level);</a>
<a name="ln199"> </a>
<a name="ln200">            stopBeep();</a>
<a name="ln201"> </a>
<a name="ln202">            moveSnakes();</a>
<a name="ln203">            checkFoodEaten();</a>
<a name="ln204">            checkCrash();</a>
<a name="ln205">            checkMaxBodySize();</a>
<a name="ln206"> </a>
<a name="ln207">            first_round = 0;</a>
<a name="ln208">        }</a>
<a name="ln209"> </a>
<a name="ln210">        showWinners();</a>
<a name="ln211"> </a>
<a name="ln212">    } while(!end_of_game);</a>
<a name="ln213">    </a>
<a name="ln214">    return 0;</a>
<a name="ln215">}</a>
<a name="ln216"> </a>
<a name="ln217"> </a>
<a name="ln218">// ================================================================================ GAME SETUP ================================================================================</a>
<a name="ln219"> </a>
<a name="ln220">static void setSquareDimensions(void) {</a>
<a name="ln221">    square.width = SQUARE_DIM;</a>
<a name="ln222">    square.height = SQUARE_DIM;</a>
<a name="ln223">}</a>
<a name="ln224"> </a>
<a name="ln225">static void setDefaultFeatures(void) {</a>
<a name="ln226">    for(int i = 0; i &lt; snakes_amount; i++){</a>
<a name="ln227">        snakes[i].initial_hue = hues[i];</a>
<a name="ln228">        snakes[i].main_ansi = main_colors[i];</a>
<a name="ln229">        snakes[i].direction.x = initial_directions[i].x;</a>
<a name="ln230">        snakes[i].direction.y = initial_directions[i].y;</a>
<a name="ln231">        snakes[i].size = INITIAL_BODY_SIZE + 1;</a>
<a name="ln232">        for(int k = 0; k &lt; INITIAL_BODY_SIZE + 1; k++){</a>
<a name="ln233">            snakes[i].body[k].position.x = initial_positions[i].x - k * snakes[i].direction.x * SQUARE_DIM;</a>
<a name="ln234">            snakes[i].body[k].position.y = initial_positions[i].y - k * snakes[i].direction.y * SQUARE_DIM;</a>
<a name="ln235">        }</a>
<a name="ln236">        snakes[i].lost = 0;</a>
<a name="ln237">    }</a>
<a name="ln238">    food.hue = DEFAULT_FOOD_COLOR;</a>
<a name="ln239">    randomizeFoodPosition();</a>
<a name="ln240">}</a>
<a name="ln241"> </a>
<a name="ln242"> </a>
<a name="ln243">// ================================================================================ GAME START/END ================================================================================</a>
<a name="ln244"> </a>
<a name="ln245">static void welcomePlayers(void) {</a>
<a name="ln246">    int players_result = 0;</a>
<a name="ln247"> </a>
<a name="ln248">    setFontSize(3);</a>
<a name="ln249">    printf(&quot;\n\t\t\e[0;32mWelcome to the snake game!\e[0m\n\n&quot;);</a>
<a name="ln250">    setFontSize(2);</a>
<a name="ln251"> </a>
<a name="ln252">    sleep(DEFAULT_WELCOME_SLEEPING_TIME);</a>
<a name="ln253"> </a>
<a name="ln254">    do{</a>
<a name="ln255">        do{</a>
<a name="ln256">            printf(&quot;\tEnter the number of players (maximum %d):&quot;, MAX_SNAKES);</a>
<a name="ln257">            players_result = scanf(&quot;%d&quot;, &amp;snakes_amount);</a>
<a name="ln258">        } while(players_result != 1);</a>
<a name="ln259"> </a>
<a name="ln260">    } while(snakes_amount &gt; MAX_SNAKES || snakes_amount &lt;= 0);</a>
<a name="ln261"> </a>
<a name="ln262"> </a>
<a name="ln263">    int dif_result = 0;</a>
<a name="ln264">    char difficulty[1] = {0};</a>
<a name="ln265"> </a>
<a name="ln266">    do{</a>
<a name="ln267">        do{</a>
<a name="ln268">            printf(&quot;\n\tEnter difficulty\n&quot;);</a>
<a name="ln269">            printf(&quot;\t(E)asy, (M)edium, (H)ard, (D)emon: &quot;);   </a>
<a name="ln270">            dif_result = scanf(&quot;%s&quot;, difficulty);</a>
<a name="ln271">            </a>
<a name="ln272">        } while(dif_result != 1);</a>
<a name="ln273"> </a>
<a name="ln274">    } while(!VALID_DIFFICULTY(*difficulty));</a>
<a name="ln275"> </a>
<a name="ln276">    setDifficulty(*difficulty);</a>
<a name="ln277"> </a>
<a name="ln278">    clearScreen();</a>
<a name="ln279"> </a>
<a name="ln280">    for(int i = 0; i &lt; snakes_amount; i++){</a>
<a name="ln281">        printf(&quot;%sPlayer %d keys:\e[0m\n\n&quot;, main_colors[i], i + 1);</a>
<a name="ln282">        for(int k = 0; k &lt; DIRECTIONS; k++){</a>
<a name="ln283">            printf(&quot;\t\t%s\t \e[0;35m-&gt;\e[0m %s\n&quot;, movement_directions[k], movement_keys[i][k]);</a>
<a name="ln284">        }</a>
<a name="ln285">        printf(&quot;\n\n&quot;);</a>
<a name="ln286">    }</a>
<a name="ln287"> </a>
<a name="ln288">    sleep(DEFAULT_INSTRUCTIONS_SLEEPING_TIME);</a>
<a name="ln289"> </a>
<a name="ln290">    printf(&quot;If any player eats %d foods, becomes the winner.\n\nDon't crash against the walls!\n\nAt any time, press X to quit.\n\nPress ENTER to begin&quot;, MAX_BODY_SIZE - INITIAL_BODY_SIZE - 1);</a>
<a name="ln291"> </a>
<a name="ln292">    while(getCharacterWithoutDisplay() != BEGIN_GAME_KEY);</a>
<a name="ln293"> </a>
<a name="ln294">    clearScreen();</a>
<a name="ln295">}</a>
<a name="ln296"> </a>
<a name="ln297">static void checkMaxBodySize(void) {</a>
<a name="ln298">    for(int i = 0; i &lt; snakes_amount; i++){</a>
<a name="ln299">        if(snakes[i].size == MAX_BODY_SIZE){</a>
<a name="ln300">            endGameByMaxSize();</a>
<a name="ln301">        }</a>
<a name="ln302">    }</a>
<a name="ln303">    if(end_of_game == ENDED_BY_MAX_SIZE){</a>
<a name="ln304">        for(int i = 0; i &lt; snakes_amount; i++){</a>
<a name="ln305">            if(snakes[i].size != MAX_BODY_SIZE){</a>
<a name="ln306">                snakes[i].lost = 1;</a>
<a name="ln307">            }</a>
<a name="ln308">        }</a>
<a name="ln309">    }</a>
<a name="ln310">    </a>
<a name="ln311">}</a>
<a name="ln312"> </a>
<a name="ln313">static void endGameByMaxSize(void) {</a>
<a name="ln314">    endGame(ENDED_BY_MAX_SIZE);</a>
<a name="ln315">}</a>
<a name="ln316"> </a>
<a name="ln317">static void endGameByQuit(void) {</a>
<a name="ln318">    endGame(ENDED_BY_QUIT);</a>
<a name="ln319">}</a>
<a name="ln320"> </a>
<a name="ln321">static void endGameByCrash(void) {</a>
<a name="ln322">    startBeep(CRASHING_SOUND_FREQUENCY);</a>
<a name="ln323">    sleep(CRASHING_SOUND_DURATION);</a>
<a name="ln324">    stopBeep();</a>
<a name="ln325">    endGame(ENDED_BY_CRASH);</a>
<a name="ln326">}</a>
<a name="ln327"> </a>
<a name="ln328">static void endGame(int code) {</a>
<a name="ln329">    end_of_game = code;</a>
<a name="ln330">}</a>
<a name="ln331"> </a>
<a name="ln332">static void showWinners(void) {</a>
<a name="ln333">    if(end_of_game == ENDED_BY_CRASH || end_of_game == ENDED_BY_MAX_SIZE){</a>
<a name="ln334">        clearScreen();</a>
<a name="ln335"> </a>
<a name="ln336">        int c;</a>
<a name="ln337"> </a>
<a name="ln338">        printf(&quot;\n\n\n&quot;);</a>
<a name="ln339"> </a>
<a name="ln340">        if(snakes_amount == 1){</a>
<a name="ln341">            printf(&quot;\t&quot;);</a>
<a name="ln342">            if(!snakes[0].lost){</a>
<a name="ln343">                printf(&quot;You won, congratulations!\n&quot;);</a>
<a name="ln344">            } else{</a>
<a name="ln345">                printf(&quot;You lost.\n&quot;);</a>
<a name="ln346">            }</a>
<a name="ln347">            printf(&quot;\tScore: %d\n&quot;, snakes[0].size - (INITIAL_BODY_SIZE + 1));</a>
<a name="ln348">            printf(&quot;\n\n&quot;);</a>
<a name="ln349">        } else{</a>
<a name="ln350">            for(int i = 0; i &lt; snakes_amount; i++){</a>
<a name="ln351">                printf(&quot;\t&quot;);</a>
<a name="ln352">                if(!snakes[i].lost){</a>
<a name="ln353">                    printf(&quot;%sPlayer %d won, congratulations!\e[0m\n&quot;, snakes[i].main_ansi, i + 1);</a>
<a name="ln354">                    printf(&quot;\tScore: %d\n&quot;, snakes[i].size - (INITIAL_BODY_SIZE + 1));</a>
<a name="ln355">                } else{</a>
<a name="ln356">                    printf(&quot;%sPlayer %d lost :( \e[0m\n&quot;, snakes[i].main_ansi, i + 1);</a>
<a name="ln357">                    printf(&quot;\tScore: %d\n&quot;, snakes[i].size - (INITIAL_BODY_SIZE + 1));</a>
<a name="ln358">                }</a>
<a name="ln359">                printf(&quot;\n&quot;);</a>
<a name="ln360">            }</a>
<a name="ln361">        }</a>
<a name="ln362"> </a>
<a name="ln363">        sleep(DEFAULT_GOODBYE_SLEEPING_TIME);</a>
<a name="ln364"> </a>
<a name="ln365">        printf(&quot;\n\e[0;32m----------------------------------------------------------------\e[0m \</a>
<a name="ln366">        \n\n\t\t\tPress ENTER to play again, X to finish&quot;);</a>
<a name="ln367"> </a>
<a name="ln368">        while((c = getCharacterWithoutDisplay()) != PLAY_AGAIN_KEY &amp;&amp; toupper(c) != QUIT_KEY);</a>
<a name="ln369"> </a>
<a name="ln370">        if(c == PLAY_AGAIN_KEY){</a>
<a name="ln371">            end_of_game = 0;</a>
<a name="ln372">        }</a>
<a name="ln373">    }</a>
<a name="ln374">}</a>
<a name="ln375"> </a>
<a name="ln376"> </a>
<a name="ln377">// ================================================================================ MOVING LOGIC ================================================================================</a>
<a name="ln378"> </a>
<a name="ln379">static void registerKeys(void) {</a>
<a name="ln380">    // player 1 keys</a>
<a name="ln381">    registerKey(KP_UP_KEY, setDirection);</a>
<a name="ln382">    registerKey(KP_DOWN_KEY, setDirection);</a>
<a name="ln383">    registerKey(KP_LEFT_KEY, setDirection);</a>
<a name="ln384">    registerKey(KP_RIGHT_KEY, setDirection);</a>
<a name="ln385"> </a>
<a name="ln386">    // player 2 keys</a>
<a name="ln387">    registerKey(W_KEY, setDirection);</a>
<a name="ln388">    registerKey(S_KEY, setDirection);</a>
<a name="ln389">    registerKey(A_KEY, setDirection);</a>
<a name="ln390">    registerKey(D_KEY, setDirection);</a>
<a name="ln391"> </a>
<a name="ln392">    registerKey(X_KEY, (void (*)(enum REGISTERABLE_KEYS scancode)) endGameByQuit);</a>
<a name="ln393">}</a>
<a name="ln394"> </a>
<a name="ln395">static void movingTo(int snake, int dir_x, int dir_y) {</a>
<a name="ln396">    snake -= 1;</a>
<a name="ln397">    </a>
<a name="ln398">    int forbiddenX = -(snakes[snake].body[HEAD].position.x - snakes[snake].body[1].position.x) / SQUARE_DIM;</a>
<a name="ln399">    int forbiddenY = -(snakes[snake].body[HEAD].position.y - snakes[snake].body[1].position.y) / SQUARE_DIM;</a>
<a name="ln400"> </a>
<a name="ln401">    if (!(dir_x == forbiddenX &amp;&amp; dir_y == forbiddenY)) {</a>
<a name="ln402">        snakes[snake].direction.x = dir_x;</a>
<a name="ln403">        snakes[snake].direction.y = dir_y;</a>
<a name="ln404">    }</a>
<a name="ln405">}</a>
<a name="ln406"> </a>
<a name="ln407">static void setDirection(enum REGISTERABLE_KEYS scancode) {</a>
<a name="ln408">    switch (scancode) {</a>
<a name="ln409">        case KP_UP_KEY:</a>
<a name="ln410">            movingTo(1, 0, -1);</a>
<a name="ln411">            break;</a>
<a name="ln412">        case KP_DOWN_KEY:</a>
<a name="ln413">            movingTo(1, 0, 1);</a>
<a name="ln414">            break;</a>
<a name="ln415">        case KP_LEFT_KEY:</a>
<a name="ln416">            movingTo(1, -1, 0);</a>
<a name="ln417">            break;</a>
<a name="ln418">        case KP_RIGHT_KEY:</a>
<a name="ln419">            movingTo(1, 1, 0);</a>
<a name="ln420">            break;</a>
<a name="ln421">        </a>
<a name="ln422">        case W_KEY:</a>
<a name="ln423">            movingTo(2, 0, -1);</a>
<a name="ln424">            break;</a>
<a name="ln425">        case S_KEY:</a>
<a name="ln426">            movingTo(2, 0, 1);</a>
<a name="ln427">            break;</a>
<a name="ln428">        case A_KEY:</a>
<a name="ln429">            movingTo(2, -1, 0);</a>
<a name="ln430">            break;</a>
<a name="ln431">        case D_KEY:</a>
<a name="ln432">            movingTo(2, 1, 0);</a>
<a name="ln433">            break;</a>
<a name="ln434">        default:</a>
<a name="ln435">            break;</a>
<a name="ln436">    }</a>
<a name="ln437">}</a>
<a name="ln438"> </a>
<a name="ln439">static void moveSnakes(void) {</a>
<a name="ln440">    for(int i = 0; i &lt; snakes_amount; i++){</a>
<a name="ln441">        // move each square, except head</a>
<a name="ln442">        for(int k = snakes[i].size - 1; k &gt; 0; k--) {</a>
<a name="ln443">            snakes[i].body[k].position.x = snakes[i].body[k - 1].position.x;</a>
<a name="ln444">            snakes[i].body[k].position.y = snakes[i].body[k - 1].position.y;</a>
<a name="ln445">        }</a>
<a name="ln446"> </a>
<a name="ln447">        // move head</a>
<a name="ln448">        snakes[i].body[HEAD].position.x += snakes[i].direction.x * SQUARE_DIM;</a>
<a name="ln449">        snakes[i].body[HEAD].position.y += snakes[i].direction.y * SQUARE_DIM;</a>
<a name="ln450">    }</a>
<a name="ln451">}</a>
<a name="ln452"> </a>
<a name="ln453">static void checkCrash(void) {</a>
<a name="ln454">    int somebody_crashed = 0;</a>
<a name="ln455">    for(int i = 0; i &lt; snakes_amount; i++){</a>
<a name="ln456">        // checks whether the snake crashed with a border</a>
<a name="ln457">        if(outOfBounds(snakes[i].body[0].position.x, snakes[i].body[0].position.y)){</a>
<a name="ln458">            snakes[i].lost = 1;</a>
<a name="ln459">            somebody_crashed = 1;</a>
<a name="ln460">        }</a>
<a name="ln461"> </a>
<a name="ln462">        // checks whether the snake crashed with itself</a>
<a name="ln463">        for(int k = 1; k &lt; snakes[i].size - 1 &amp;&amp; !end_of_game; k++){</a>
<a name="ln464">            if(snakes[i].body[0].position.x == snakes[i].body[k].position.x &amp;&amp; snakes[i].body[0].position.y == snakes[i].body[k].position.y){</a>
<a name="ln465">                snakes[i].lost = 1;</a>
<a name="ln466">                somebody_crashed = 1;</a>
<a name="ln467">            }</a>
<a name="ln468">        }</a>
<a name="ln469"> </a>
<a name="ln470">        // checks whether snakes crashed with each other</a>
<a name="ln471">        for(int k = 0; k &lt; snakes_amount; k++){</a>
<a name="ln472">            if(i != k){</a>
<a name="ln473">                for(int j = 0; j &lt; snakes[k].size - 1; j++){</a>
<a name="ln474">                    if(snakes[i].body[0].position.x == snakes[k].body[j].position.x &amp;&amp; snakes[i].body[0].position.y == snakes[k].body[j].position.y){</a>
<a name="ln475">                        snakes[i].lost = 1;</a>
<a name="ln476">                        // if both heads crash, both players lose</a>
<a name="ln477">                        if(j == 0){</a>
<a name="ln478">                            snakes[k].lost = 1;</a>
<a name="ln479">                        }</a>
<a name="ln480">                        somebody_crashed = 1;</a>
<a name="ln481">                    }</a>
<a name="ln482">                }</a>
<a name="ln483">            }</a>
<a name="ln484">        }</a>
<a name="ln485">    }</a>
<a name="ln486">    if(somebody_crashed){</a>
<a name="ln487">        endGameByCrash();</a>
<a name="ln488">    }</a>
<a name="ln489">}</a>
<a name="ln490"> </a>
<a name="ln491">static int outOfBounds(int x, int y) {</a>
<a name="ln492">    return (x &lt; 0 || x &gt; (window_width - SQUARE_DIM) || y &lt; border_y || y &gt; (window_height - SQUARE_DIM));</a>
<a name="ln493">}</a>
<a name="ln494"> </a>
<a name="ln495"> </a>
<a name="ln496">// ================================================================================ DRAWING LOGIC ================================================================================</a>
<a name="ln497"> </a>
<a name="ln498">static void drawBackground(void) {</a>
<a name="ln499">    for(int y = border_y; y &lt; window_height; y += square.height){</a>
<a name="ln500">        for(int x = 0; x &lt; window_width; x += square.width){</a>
<a name="ln501">            if(first_round || !(x == food.position.x &amp;&amp; y == food.position.y)){</a>
<a name="ln502">                drawRectangle(DEFAULT_BACKGROUND_COLOR, square.width - OFFSET, square.height - OFFSET, x + OFFSET, y + OFFSET);</a>
<a name="ln503">            }</a>
<a name="ln504">        }</a>
<a name="ln505">    }</a>
<a name="ln506">}</a>
<a name="ln507"> </a>
<a name="ln508">static void drawSnakes(void) {</a>
<a name="ln509">    for(int i = 0; i &lt; snakes_amount; i++){</a>
<a name="ln510">        //set last (phantom) snake body's rectangle to black</a>
<a name="ln511">        drawRectangle(DEFAULT_BACKGROUND_COLOR, square.width - OFFSET, square.height - OFFSET, snakes[i].body[snakes[i].size - 1].position.x + OFFSET, snakes[i].body[snakes[i].size - 1].position.y + OFFSET);</a>
<a name="ln512"> </a>
<a name="ln513">        for(int k = 0; k &lt; snakes[i].size - 1; k++){</a>
<a name="ln514">            drawRectangle(hsv2rgb(k * 10 + snakes[i].initial_hue, 255, 255), square.width - OFFSET, square.height - OFFSET, snakes[i].body[k].position.x + OFFSET, snakes[i].body[k].position.y + OFFSET);</a>
<a name="ln515">        }</a>
<a name="ln516">    }</a>
<a name="ln517">}</a>
<a name="ln518"> </a>
<a name="ln519">static void drawFood(void) {</a>
<a name="ln520">    drawCircle(food.hue, food.position.x + OFFSET, food.position.y + OFFSET, SQUARE_DIM - OFFSET);</a>
<a name="ln521">}</a>
<a name="ln522"> </a>
<a name="ln523">static void printScore(void) {</a>
<a name="ln524">    printf(&quot;\r&quot;);</a>
<a name="ln525"> </a>
<a name="ln526">    if(snakes_amount == 1){</a>
<a name="ln527">        printf(&quot;\t\t\t\t\t\t&quot;);</a>
<a name="ln528">        printf(&quot;%sPlayer %d score: %d\e[0m&quot;, snakes[0].main_ansi, 1, snakes[0].size - (INITIAL_BODY_SIZE + 1));</a>
<a name="ln529">    } else{</a>
<a name="ln530">        for(int i = 0 ; i &lt; snakes_amount; i++){</a>
<a name="ln531">            printf(&quot;\t\t  &quot;);</a>
<a name="ln532">            printf(&quot;%sPlayer %d score: %d\e[0m&quot;, snakes[i].main_ansi, i + 1, snakes[i].size - (INITIAL_BODY_SIZE + 1));</a>
<a name="ln533">        }</a>
<a name="ln534">    }</a>
<a name="ln535">}</a>
<a name="ln536"> </a>
<a name="ln537"> </a>
<a name="ln538">// ================================================================================ FOOD LOGIC ================================================================================</a>
<a name="ln539"> </a>
<a name="ln540">static void setRandomSeed(void) {</a>
<a name="ln541">    int hours, minutes, seconds;</a>
<a name="ln542">    getDate(&amp;hours, &amp;minutes, &amp;seconds);</a>
<a name="ln543">    srand(seconds);</a>
<a name="ln544">}</a>
<a name="ln545"> </a>
<a name="ln546">static void  setDifficulty(char difficulty) {</a>
<a name="ln547">    switch (toupper(difficulty)) {</a>
<a name="ln548">        case 'E':</a>
<a name="ln549">            difficulty_level = EASY;</a>
<a name="ln550">            break;</a>
<a name="ln551">        case 'M':</a>
<a name="ln552">            difficulty_level = MEDIUM;</a>
<a name="ln553">            break;</a>
<a name="ln554">        case 'H':</a>
<a name="ln555">            difficulty_level = HARD;</a>
<a name="ln556">            break;</a>
<a name="ln557">        case 'D':</a>
<a name="ln558">            difficulty_level = DEMON;</a>
<a name="ln559">            break;</a>
<a name="ln560">        default:</a>
<a name="ln561">            break;</a>
<a name="ln562">    }</a>
<a name="ln563">}</a>
<a name="ln564"> </a>
<a name="ln565">static int overSnakeBody(int x, int y) {</a>
<a name="ln566">    int over_snake = 0;</a>
<a name="ln567"> </a>
<a name="ln568">    for(int i = 0; i &lt; snakes_amount &amp;&amp; !over_snake; i++){</a>
<a name="ln569">        for(int k = 0; k &lt; snakes[i].size - 1 &amp;&amp; !over_snake; k++){</a>
<a name="ln570">            if(snakes[i].body[k].position.x == x &amp;&amp; snakes[i].body[k].position.y == y) {</a>
<a name="ln571">                over_snake = 1;</a>
<a name="ln572">            }</a>
<a name="ln573">        }</a>
<a name="ln574">    }</a>
<a name="ln575"> </a>
<a name="ln576">    return over_snake;</a>
<a name="ln577">}</a>
<a name="ln578"> </a>
<a name="ln579">static void randomizeFoodPosition(void) {</a>
<a name="ln580">    int x, y;</a>
<a name="ln581"> </a>
<a name="ln582">    do {</a>
<a name="ln583">        x = (rand() % SQUARE_DIM) * SQUARE_DIM;</a>
<a name="ln584">        x = x % (window_width);</a>
<a name="ln585"> </a>
<a name="ln586">        y = (rand() % SQUARE_DIM) * SQUARE_DIM;</a>
<a name="ln587">        y = y % (window_height - border_y) + border_y;</a>
<a name="ln588"> </a>
<a name="ln589">    } while(overSnakeBody(x, y));</a>
<a name="ln590"> </a>
<a name="ln591">    food.position.x = x;</a>
<a name="ln592">    food.position.y = y;</a>
<a name="ln593">}</a>
<a name="ln594"> </a>
<a name="ln595">static void checkFoodEaten(void) {</a>
<a name="ln596">    for(int i = 0 ; i &lt; snakes_amount; i++){</a>
<a name="ln597">        if(snakes[i].body[HEAD].position.x == food.position.x &amp;&amp; snakes[i].body[HEAD].position.y == food.position.y){</a>
<a name="ln598">            int s = snakes[i].size++;</a>
<a name="ln599">            snakes[i].body[s].position.x = snakes[i].body[s - 1].position.x;</a>
<a name="ln600">            snakes[i].body[s].position.y = snakes[i].body[s - 1].position.y;</a>
<a name="ln601">            food_eaten = 1;</a>
<a name="ln602">        }</a>
<a name="ln603">    }</a>
<a name="ln604"> </a>
<a name="ln605">    if(food_eaten){</a>
<a name="ln606">        startBeep(EATING_SOUND_FREQUENCY);</a>
<a name="ln607">        randomizeFoodPosition();</a>
<a name="ln608">        printScore();</a>
<a name="ln609">        food_eaten = 0;</a>
<a name="ln610">    }</a>
<a name="ln611">}</a>
<a name="ln612"> </a>
<a name="ln613"> </a>
<a name="ln614">// ================================================================================ COLORED SNAKE LOGIC ================================================================================</a>
<a name="ln615"> </a>
<a name="ln616">// Hand transpiled from https://github.com/hughsk/glsl-hsv2rgb/blob/master/index.glsl</a>
<a name="ln617">#define clamp(x, min, max) ((x) &lt; (min) ? (min) : ((x) &gt; (max) ? (max) : (x)))</a>
<a name="ln618">#define abs(a) ((a) &lt; 0 ? -(a) : (a))</a>
<a name="ln619">#define fract256(x) ((x) % 256)</a>
<a name="ln620">// Hand transpiled from https://github.com/hughsk/glsl-hsv2rgb/blob/master/index.glsl</a>
<a name="ln621">static uint32_t hsv2rgb(uint8_t h, uint8_t s, uint8_t v) {</a>
<a name="ln622">//   vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);</a>
<a name="ln623">//   vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);</a>
<a name="ln624">//   return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);</a>
<a name="ln625">    uint16_t pr = abs(fract256( h ) * 6 - 255*3);</a>
<a name="ln626">    uint16_t pg = abs(fract256( h + (85*2) ) * 6 - 255*3);</a>
<a name="ln627">    uint16_t pb = abs(fract256( h + 85 ) * 6 - 255*3);</a>
<a name="ln628">    return (((v * clamp(pr-256, 0, 255)) / 255) &lt;&lt; 16) | (((v * clamp(pg-256, 0, 255)) / 255) &lt;&lt; 8) | (v * clamp(pb-256, 0, 255)) / 255;</a>
<a name="ln629">}</a>
</code></pre>
<div class="balloon" rel="270"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v576/" target="_blank">V576</a> Incorrect format. Consider checking the second actual argument of the 'scanf' function. It's dangerous to use string specifier without width specification. Buffer overflow is possible.</p></div>
<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>